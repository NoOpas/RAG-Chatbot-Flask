# ğŸ“„ README.md

# Ğ§Ğ°Ñ‚-Ğ±Ğ¾Ñ‚ Ğ¿Ğ¾ ÑƒÑ‡ĞµĞ±Ğ½Ğ¾-ÑĞ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¾Ğ¼Ñƒ Ğ¿Ğ¾Ñ€Ñ‚Ğ°Ğ»Ñƒ: RAG-Ğ°ÑÑĞ¸ÑÑ‚ĞµĞ½Ñ‚ Ğ½Ğ° Ğ±Ğ°Ğ·Ğµ Saiga-Mistral-7B  
> Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ‡Ğ°Ñ‚-Ğ±Ğ¾Ñ‚, Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¾Ğ¹ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… 

[![Python](https://img.shields.io/badge/Python-3.10%2B-blue)](https://python.org)  
[![Flask](https://img.shields.io/badge/Flask-2.x-black)](https://flask.palletsprojects.com)  
[![License](https://img.shields.io/badge/License-MIT-green)](LICENSE)

---

## ğŸ“– ĞĞ±Ğ·Ğ¾Ñ€

Ğ­Ñ‚Ğ¾ Ğ²ĞµĞ±-Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼ Ğ·Ğ°Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹ Ğ½Ğ° Ñ€ÑƒÑÑĞºĞ¾Ğ¼ ÑĞ·Ñ‹ĞºĞµ Ğ¿Ğ¾ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ğ°Ğ¼ ÑƒÑ‡ĞµĞ±Ğ½Ğ¾-ÑĞ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ñ€Ñ‚Ğ°Ğ»Ğ°. ĞÑ‚Ğ²ĞµÑ‚Ñ‹ Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒÑÑ‚ÑÑ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ¹ ÑĞ·Ñ‹ĞºĞ¾Ğ²Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒÑ **Saiga-Mistral-7B-GPTQ** Ñ ÑƒÑ‡Ñ‘Ñ‚Ğ¾Ğ¼ Ñ€ĞµĞ»ĞµĞ²Ğ°Ğ½Ñ‚Ğ½Ñ‹Ñ… Ñ„Ñ€Ğ°Ğ³Ğ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ², Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ñ… Ñ‡ĞµÑ€ĞµĞ· ÑĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ğ² **PostgreSQL + pgvector**.

**ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸**:
- âœ… ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¾Ğ²Ğ°Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ (SSE) â€” Ñ‚Ğ¾ĞºĞµĞ½Ñ‹ Ğ¿Ğ¾ÑĞ²Ğ»ÑÑÑ‚ÑÑ Ğ¿Ğ¾ Ğ¼ĞµÑ€Ğµ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
- âœ… Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸ Ğ¿Ğ¾Ğ´ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¼ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ¼ â€” Ñ‚Ğ¾Ñ‡Ğ½Ğ¾Ğµ Ñ†Ğ¸Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
- âœ… ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Ñ€Ğ°Ğ·Ğ±Ğ¸ĞµĞ½Ğ¸Ğµ Ğ½Ğ° Ñ‡Ğ°Ğ½ĞºĞ¸
- âœ… ĞĞ¸Ğ·ĞºĞ¸Ğµ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğº GPU (Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ 8 Ğ“Ğ‘ VRAM)
- âœ… ĞŸĞ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº â€” Ğ½Ğ¸ĞºĞ°ĞºĞ¸Ñ… Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ñ… API

---

## ğŸš€ Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸

- ğŸ§  **RAG-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°**: Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ â†’ Ğ ĞµÑ€Ğ°Ğ½ĞºĞ¸Ğ½Ğ³ â†’ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ  
- ğŸ“¡ **Ğ¡Ñ‚Ñ€Ğ¸Ğ¼Ğ¸Ğ½Ğ³ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²**: ĞŸĞ¾ÑÑ‚ĞµĞ¿ĞµĞ½Ğ½Ğ¾Ğµ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ² (ĞºĞ°Ğº Ğ² ÑĞ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ñ… Ñ‡Ğ°Ñ‚-Ğ±Ğ¾Ñ‚Ğ°Ñ…)  
- ğŸ“š **Ğ¢Ğ¾Ñ‡Ğ½Ğ¾Ğµ Ñ†Ğ¸Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ**: ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚ ÑĞ¾Ğ¿Ñ€Ğ¾Ğ²Ğ¾Ğ¶Ğ´Ğ°ĞµÑ‚ÑÑ ÑÑÑ‹Ğ»ĞºĞ°Ğ¼Ğ¸ Ğ½Ğ° Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ¸  
- ğŸŒ **Ğ’ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ**: Ğ§Ğ¸ÑÑ‚Ñ‹Ğ¹ UI Ñ Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºĞ¾Ğ¹, ĞºĞ½Ğ¾Ğ¿ĞºĞ¾Ğ¹ Ğ²Ğ½Ğ¸Ğ·, Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¼ Ñ‡Ğ°Ñ‚Ğ¾Ğ¼  
- ğŸ“Š **Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ**: `loguru` â€” ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒ + Ñ„Ğ°Ğ¹Ğ», Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¾Ğ¹ Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº  
- ğŸ”’ **Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº**: Ğ’ÑĞµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğ° Ğ²Ğ°ÑˆĞµĞ¹ Ğ¼Ğ°ÑˆĞ¸Ğ½Ğµ â€” Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ½Ğ¾Ğ¼Ğ½Ğ¾  

---

## âš™ï¸ Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº

| Layer | Technology | Why |
|-------|------------|-----|
| **Backend** | Flask 2.x, Python 3.10+ | Ğ›Ñ‘Ğ³ĞºĞ¾Ğ²ĞµÑĞ½Ñ‹Ğ¹, Ğ±Ñ‹ÑÑ‚Ñ€Ğ°Ñ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°, Ğ¸Ğ´ĞµĞ°Ğ»ĞµĞ½ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ñ‚Ğ¾Ñ‚Ğ¸Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞµĞ½Ğ° |
| **LLM** | Saiga-Mistral-7B-GPTQ (4-bit) | ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğ° Ğ¸ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ½Ğ° GPU Ñ 8+ Ğ“Ğ‘ VRAM |
| **Embeddings** | `multilingual-e5-small` (384d) | Ğ’Ñ‹ÑĞ¾ĞºĞ°Ñ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ Ğ´Ğ»Ñ Ñ€ÑƒÑÑĞºĞ¾Ğ³Ğ¾ ÑĞ·Ñ‹ĞºĞ°, Ğ½Ğ¸Ğ·ĞºĞ¾Ğµ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸ |
| **Vector DB** | PostgreSQL 15+ + `pgvector` | ĞĞ°Ğ´Ñ‘Ğ¶Ğ½Ğ¾, Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾, Ğ»ĞµĞ³ĞºĞ¾ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ñ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¼Ğ¸ Ğ‘Ğ” |
| **Frontend** | Vanilla JS + SSE | ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»Ğ¸ÑÑ‚Ğ¸Ñ‡Ğ½Ğ¾, Ğ±ĞµĞ· Ñ‚ÑĞ¶Ñ‘Ğ»Ñ‹Ñ… Ñ„Ñ€ĞµĞ¹Ğ¼Ğ²Ğ¾Ñ€ĞºĞ¾Ğ², Ğ±Ñ‹ÑÑ‚Ñ€Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° |
| **Logging** | `loguru` | Ğ¦Ğ²ĞµÑ‚Ğ½Ñ‹Ğµ Ğ»Ğ¾Ğ³Ğ¸ Ğ² ĞºĞ¾Ğ½ÑĞ¾Ğ»Ğ¸ + Ñ€Ğ¾Ñ‚Ğ°Ñ†Ğ¸Ñ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ², thread-safe |
| **Packaging** | `uv` | Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ Ğ¼ĞµĞ½ĞµĞ´Ğ¶ĞµÑ€ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ Ğ¸ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ñ… Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğ¹ Ğ¾Ñ‚ Astral |
| **Hardware** | NVIDIA GPU â‰¥ 8 Ğ“Ğ‘ VRAM | ĞœĞ¸Ğ½Ğ¸Ğ¼ÑƒĞ¼ Ğ´Ğ»Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ ĞºĞ²Ğ°Ğ½Ñ‚Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¹ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ² 4-Ğ±Ğ¸Ñ‚Ğ½Ğ¾Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ |

---

## ğŸ› ï¸ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°

### 5.1 Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

- Python 3.10+
- [uv](https://docs.astral.sh/uv/) â€” ultra-fast Python package installer & resolver
- PostgreSQL 15+ Ñ Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸ĞµĞ¼ [`pgvector`](https://github.com/pgvector/pgvector)
- NVIDIA GPU (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ â‰¥ 8 Ğ“Ğ‘ VRAM)

> ğŸ’¡ Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ `uv`:  
> ```bash
> curl -LsSf https://astral.sh/uv/install.sh | sh
> ```

---

### 5.2 ĞšĞ»Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°

```bash
git clone https://github.com/NoOpas/RAG-Chatbot-Flask.git
cd RAG-Chatbot-Flask
uv venv          # ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ .venv
uv sync          # ÑƒÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¸Ğ· pyproject.toml
```

---

### 5.3 ĞœĞ¾Ğ´ĞµĞ»Ğ¸

Ğ¡ĞºĞ°Ñ‡Ğ°Ğ¹Ñ‚Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ¸ Ğ¿Ğ¾Ğ¼ĞµÑÑ‚Ğ¸Ñ‚Ğµ Ğ² `./models/`:

```
./models/
â”œâ”€â”€ saiga_mistral_7b-GPTQ/  
â””â”€â”€ multilingual-e5-small/  
```

> ğŸ“Œ Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `git lfs` Ğ´Ğ»Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²:
> ```bash
> git lfs install
> git clone https://huggingface.co/TheBloke/saiga_mistral_7b-GPTQ  
> git clone https://huggingface.co/intfloat/multilingual-e5-small  
> ```

---

### 5.4 ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
#### Ğ¨Ğ°Ğ³ 1: Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ğ°Ñ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° (`sp_parse_vectors` Ğ¸Ğ»Ğ¸ Ğ°Ğ½Ğ°Ğ»Ğ¾Ğ³Ğ¸Ñ‡Ğ½Ğ°Ñ)

| id | url | content |
|----|-----|---------|
| 1 | `http://sp.giprovostokneft.ru/educationalhelpcenter` | `"Ğ£Ñ‡ĞµĞ±Ğ½Ğ¾-ÑĞ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ñ€Ñ‚Ğ°Ğ» - Ğ”Ğ¾Ğ¼Ğ°ÑˆĞ½ÑÑ Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ° Ğ·Ğ½Ğ°Ğ½Ğ¸ÑĞ¼Ğ¸. Ğ¢Ğ°Ğº Ğ¶Ğµ Ğ²Ñ‹ Ğ½Ğ°Ğ¹Ğ´Ñ‘Ñ‚Ğµ ÑÑÑ‹Ğ»ĞºĞ¸ Ğ½Ğ° ÑĞ°Ğ¹Ñ‚Ñ‹ ÑĞ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ñ‹Ñ… Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ğ¾Ğ² ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ¾Ğ²..."` |
| 2 | `http://sp.giprovostokneft.ru/educationalhelpcenter/ING_RU` | `"Ğ˜Ğ½Ğ¶-Ğ Ğ£ - Ğ”Ğ¾Ğ¼Ğ°ÑˆĞ½ÑÑ Ğ¡Ğ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ñ€ĞµÑÑƒÑ€Ñ Ğ¿Ğ¾ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ½Ğ¾Ğ¼Ñƒ ĞºĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑÑƒ Ğ˜Ğ½Ğ¶-Ğ Ğ£..."` |
| 3 | `http://sp.giprovostokneft.ru/educationalhelpcenter/MagiCAD` | `"MagiCAD - Ğ”Ğ¾Ğ¼Ğ°ÑˆĞ½ÑÑ Ğ¡Ğ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ñ€ĞµÑÑƒÑ€Ñ Ğ¿Ğ¾ MagiCAD..."` |

#### Ğ¨Ğ°Ğ³ 2: Ğ—Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚Ğµ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ²ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

```bash
uv run embedder_e5.py
```

ĞĞ½ ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ `document_chunks`:

| id | original_id | url | content | embedding |
|----|-------------|-----|---------|-----------|
| 1 | 1 | `http://sp.giprovostokneft.ru/educationalhelpcenter` | `"Ğ£Ñ‡ĞµĞ±Ğ½Ğ¾-ÑĞ¿Ñ€Ğ°Ğ²Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ñ€Ñ‚Ğ°Ğ» - Ğ”Ğ¾Ğ¼Ğ°ÑˆĞ½ÑÑ Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ° Ğ·Ğ½Ğ°Ğ½Ğ¸ÑĞ¼Ğ¸..."` | `[0.0042, 0.0017, -0.0597, ...]` |
| 2 | 1 | `http://sp.giprovostokneft.ru/educationalhelpcenter` | `". Ğ‘ĞµĞ·Ğ±ÑƒĞ¼Ğ°Ğ¶Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ¿ÑƒÑĞº ĞŸĞ¡Ğ” ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸..."` | `[0.0379, -0.0290, -0.0439, ...]` |
| 3 | 1 | `http://sp.giprovostokneft.ru/educationalhelpcenter` | `". GeoniCS Ğ˜Ğ½Ğ¶ĞµĞ½ĞµÑ€Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸..."` | `[0.0139, 0.0017, -0.0508, ...]` |

> âœ… Ğ­Ñ‚Ğ° Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ ÑĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ğ¿Ñ€Ğ¸ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ².

---

### 5.5 ĞĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ (Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ñ‡ĞµÑ€ĞµĞ· `uv`)

ĞŸÑ€Ğ¾ĞµĞºÑ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ `pyproject.toml` Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ÑĞ¼Ğ¸.

#### `pyproject.toml`:
```toml
[project]
name = "local-rag-chatbot"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.10"
dependencies = [
    "accelerate>=1.12.0",
    "auto-gptq>=0.7.1",
    "flask>=3.1.2",
    "langchain>=1.1.2",
    "langchain-core>=1.1.1",
    "langchain-text-splitters>=1.0.0",
    "loguru>=0.7.3",
    "optimum>=2.0.0",
    "psycopg2-binary>=2.9.11",
    "sentence-transformers>=5.1.2",
    "torch>=2.9.1",
    "transformers>=4.57.3",
]

[tool.uv]
dev-dependencies = ["black", "ruff"]
```

#### Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°:
```bash
uv venv      # ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚ .venv (ĞµÑĞ»Ğ¸ ĞµÑ‰Ñ‘ Ğ½ĞµÑ‚)
uv sync      # ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ + dev-Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸
```

> âœ… `uv.lock` Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ â€” Ğ³Ğ°Ñ€Ğ°Ğ½Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ²Ğ¾ÑĞ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ.

---

### 5.6 Ğ—Ğ°Ğ¿ÑƒÑĞº

```bash
uv run chat.py
```

ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ Ğ² Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ:  
ğŸ‘‰ [http://localhost:5000](http://localhost:5000)

---

## ğŸ“‚ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°

```
rag-chat/
â”‚
â”œâ”€â”€ app/                          # Core application logic
â”‚   â”œâ”€â”€ __init__.py               # App factory
â”‚   â”œâ”€â”€ settings.py               # Settings (DB, paths, etc.)
â”‚   â”œâ”€â”€ models/                   # ML/AI models & utilities
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ llm.py                # Saiga loading, generation
â”‚   â”‚   â”œâ”€â”€ embedding.py          # SBERT/E5 embedding
â”‚   â”‚   â””â”€â”€ stopping.py           # StopOnSequence class
â”‚   â”‚
â”‚   â”œâ”€â”€ rag/                      # RAG pipeline
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ search.py             # search_similar_texts
â”‚   â”‚   â”œâ”€â”€ context.py            # truncate_context_by_tokens
â”‚   â”‚   â””â”€â”€ pipeline.py           # rag_pipeline_stream
â”‚   â”‚
â”‚   â”œâ”€â”€ prompts/                  # Building prompts
â”‚   â”‚   â”œâ”€â”€ RAG_template.py       # RAG prompt builder
â”‚   â”‚   â””â”€â”€ <...>_template.py     # Adding other prompt builders possible
â”‚   â”‚
â”‚   â”œâ”€â”€ db/                       # Database layer
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ connection.py         # get_db_connection, pooling
â”‚   â”‚
â”‚   â””â”€â”€ routes/                   # Flask routes & SSE
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ chat.py               # index(), stream_response()
â”‚
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index_streaming.html      # Front-end file 
â”œâ”€â”€ static/
â”‚   â””â”€â”€ style.css                 # Front-end style file 
â”‚
â”œâ”€â”€ logs/                         # (auto-created) directory with logs
â”‚
â”œâ”€â”€ chat.py                       # Main file that starts the app
â”œâ”€â”€ embedder_e5.py                # Script to create vector DB
â”œâ”€â”€ pyproject.toml                # Main libraries version control file
â””â”€â”€ uv.lock                       # (auto-created) file with all installed dependencies 
```

---

## ğŸ§  ĞšĞ°Ğº Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ (ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°)

```mermaid
flowchart LR
    A[User Query] --> B(Flask App)
    B --> C{Search}
    C --> D[PostgreSQL + pgvector]
    D --> E[Top-K Chunks]
    E --> F[Prompt Engineering]
    F --> G[Saiga-Mistral-7B]
    G --> H[SSE Stream]
    H --> I[Browser]
    I --> J[Display: tokens â†’ sources]
```

### ĞŸĞ¾ÑˆĞ°Ğ³Ğ¾Ğ²Ğ¾:

1. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ²Ğ¾Ğ´Ğ¸Ñ‚ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ â†’ `GET /stream_response?message=...`
2. Ğ­Ğ¼Ğ±ĞµĞ´Ğ´Ğ¸Ğ½Ğ³ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ° (`query: ...`) â†’ ÑĞµĞ¼Ğ°Ğ½Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿Ğ¾Ğ¸ÑĞº Ğ² `document_chunks`
3. Ğ¢Ğ¾Ğ¿-3 Ğ¸ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸ĞºĞ° â†’ Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ñ‡Ğ°Ğ½ĞºĞ¾Ğ² â†’ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ (Ğ´Ğ¾ 3000 Ñ‚Ğ¾ĞºĞµĞ½Ğ¾Ğ²)
4. Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ğ° Ğ² ÑÑ‚Ğ¸Ğ»Ğµ `Mistral-Instruct`
5. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· `TextIteratorStreamer` Ñ Ğ¾ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¾Ğ¹ Ğ¿Ğ¾ `###`
6. Ğ¢Ğ¾ĞºĞµĞ½Ñ‹ Ğ¿ĞµÑ€ĞµĞ´Ğ°ÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· **SSE** â†’ JS â†’ Ğ¿Ğ¾ÑÑ‚ĞµĞ¿ĞµĞ½Ğ½Ğ¾Ğµ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ
7. ĞŸĞ¾ÑĞ»Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° â€” ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğµ `sources` â†’ ĞºÑ€Ğ°ÑĞ¸Ğ²Ñ‹Ğ¹ ÑĞ¿Ğ¸ÑĞ¾Ğº ÑÑÑ‹Ğ»Ğ¾Ğº

---

## âš™ï¸ ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Ğ¸ Ğ¿ĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ

ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ½Ğ°Ñ…Ğ¾Ğ´ÑÑ‚ÑÑ Ğ² `app/settings.py`:

```python
# Paths
MODEL_PATH = "./models/saiga_mistral_7b-GPTQ"
EMBEDDING_MODEL_PATH = "./models/multilingual-e5-small"

# DB
DB_HOST = "localhost"
DB_NAME = "sp_parse"
DB_USER = "my_user"
DB_PASSWORD = "my_password"

# RAG
TOP_K = 3
MAX_CONTEXT_TOKENS = 3000
MAX_NEW_TOKENS = 300

# Logging
LOG_FILE = "./logs/rag_chat.log"
```

> ğŸ’¡ Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚Ğµ `DB_*` Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹ Ğ¿Ğ¾Ğ´ Ğ²Ğ°ÑˆÑƒ Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ.

---
